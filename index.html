<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
  <title>SolCrash</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <h1>🚀 SolCrash</h1>
  <p><strong>💰 Your Tokens:</strong> <span id="tokenCount">0</span></p>
  <div id="gameArea">
    <p id="multiplier">🚀 1.00x</p>
    <button id="startBtn" onclick="startGame()">▶️ Start Game</button>
    <button id="withdrawBtn" onclick="withdraw()" style="display:none;">💸 Withdraw</button>
    <p id="result"></p>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const TOKEN_KEY = 'solcrash_tokens';
    let tokens = parseInt(localStorage.getItem(TOKEN_KEY) || '0');
    document.getElementById('tokenCount').innerText = tokens;

    let multiplier = 1.00;
    let interval;
    let crashPoint;
    let gameActive = false;

    function startGame() {
      multiplier = 1.00;
      crashPoint = Math.random() * 3 + 1.5; // Crash at 1.5x to 4.5x
      gameActive = true;
      document.getElementById('result').innerText = '';
      document.getElementById('withdrawBtn').style.display = 'inline-block';
      document.getElementById('startBtn').disabled = true;

      interval = setInterval(() => {
        multiplier += 0.05;
        document.getElementById('multiplier').innerText = `🚀 ${multiplier.toFixed(2)}x`;

        if (multiplier >= crashPoint) {
          clearInterval(interval);
          gameActive = false;
          document.getElementById('withdrawBtn').style.display = 'none';
          document.getElementById('startBtn').disabled = false;
          document.getElementById('result').innerText = '💥 Crashed! You lost!';
        }
      }, 100);
    }

    function withdraw() {
      if (!gameActive) return;

      clearInterval(interval);
      gameActive = false;

      const reward = Math.floor(multiplier * 5); // reward = multiplier x 5
      tokens += reward;
      localStorage.setItem(TOKEN_KEY, tokens);
      document.getElementById('tokenCount').innerText = tokens;

      document.getElementById('withdrawBtn').style.display = 'none';
      document.getElementById('startBtn').disabled = false;
      document.getElementById('result').innerText = `✅ Withdrawn at ${multiplier.toFixed(2)}x — You earned ${reward} tokens!`;
    }
  </script>
</body>
